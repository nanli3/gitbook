# 智能代发签约管理

# **1** **系统功能设计**

## **1.1** 智能代发签约管理(540010)

### **1.1.1** 功能概述

| 功能名称              | 智能代发签约管理                                             | 功能码     | TX540010.pc |
| --------------------- | ------------------------------------------------------------ | ---------- | ----------- |
| 功能描述              | 本功能实现了对公账户签约智能代发业务，并对代发参数进行签约、解约、查询、维护管理 |            |             |
| 程序名称清单          | 程序名称                                                     | 说明       |             |
| TX540010.pc           | 主程序                                                       |            |             |
| 函数名称清单          | 函数名称                                                     | 说明       |             |
| TX540010()            | 主函数                                                       |            |             |
| TX540010_ins()        | 签约                                                         |            |             |
| TX540010_del()        | 解约                                                         |            |             |
| TX540010_sel()        | 查询                                                         |            |             |
| TX540010_upd()        | 维护                                                         |            |             |
| 数据库表/文件使用情况 | 数据库表/文件名称                                            | 说明       |             |
| otctl_df_acct         | 智能代发签约表                                               |            |             |
| otctl_union_pay       | 银联代付签约表                                               |            |             |
| 返回码定义            | 返回码                                                       | 返回码说明 |             |
| 000000                | 成功                                                         |            |             |
| 000001                | 失败                                                         |            |             |
| 030001                | 账户不存在                                                   |            |             |
| 03515                 | 账户未签约                                                   |            |             |

### **1.1.2** **用户信息**

用户角色：各级柜员

所属机构：全国网点

### **1.1.3** **输入/输出**

​	第一页输入：

| 属性               | 中文描述   | 类型   | 长度 | 必输 | 输入方式 | 备注（枚举值信息）     | 企业级数据字典引用情况（必填） | 质量校验规则（例如格式/逻辑校验等） |                              |
| ------------------ | ---------- | ------ | ---- | ---- | -------- | ---------------------- | ------------------------------ | ----------------------------------- | ---------------------------- |
| 引用字典数据项编号 | 未引用原因 |        |      |      |          |                        |                                |                                     |                              |
| FUNCTION           | 交易类型   | string | 1    | 回显 | 柜面输入 | 签约、解约、查询、维护 |                                |                                     |                              |
| ACCOUNT            | 账号       | string | 32   | 回显 | 柜面输入 | 无                     |                                |                                     | 值不能为空或长度不能超过32位 |
| ACCT_NAME          | 户名       | string | 100  | 回显 | 回显     | 无                     |                                |                                     |                              |

第二页输入：

| 属性               | 中文描述           | 类型   | 长度 | 必输 | 输入方式 | 备注（枚举值信息） | 企业级数据字典引用情况（必填） | 质量校验规则（例如格式/逻辑校验等） |                                                              |
| ------------------ | ------------------ | ------ | ---- | ---- | -------- | ------------------ | ------------------------------ | ----------------------------------- | ------------------------------------------------------------ |
| 引用字典数据项编号 | 未引用原因         |        |      |      |          |                    |                                |                                     |                                                              |
| ACCOUNT            | 账号               | string | 32   | 必输 | 回显     | 无                 |                                |                                     |                                                              |
| ACCT_NAME          | 户名               | string | 100  | 必输 | 回显     | 无                 |                                |                                     |                                                              |
| PROD_ID            | 产品编号           | string | 14   | 必输 | 回显     | 无                 |                                |                                     |                                                              |
| MERCH_ID           | 商户类别码         | string | 16   | 必输 | 柜面输入 | 无                 |                                |                                     | 与银联贷记业务商户类别码一致                                 |
| SEND_CHNL          | 发起渠道           | string | 254  | 必输 | 柜面输入 | 无                 |                                |                                     | 客户发起渠道为：柜面、银企直联、企业网银及两两组合、全部渠道（一期暂不支持中间业务平台），建议留一个“其他”选项，方便扩展。（外系统签约交易嵌入） |
| PRINT_FLAG         | 回单打印标志       | string | 1    | 必输 | 柜面输入 | 无                 |                                |                                     | 打印、不打印、电子回单（银企直联），该标志仅限于智能代发交易的回单打印，与客户其他交易正常的转账无关。 |
| PRINT_TYPE         | 回单打印方式       | string | 1    | 必输 | 柜面输入 | 无                 |                                |                                     | 当选择打印时，显示如下：按笔打印、按日打印、按批次打印，如选择电子回单，则柜面不再打印回单 |
| HB_CHNL            | 跨行渠道选择标志   | string | 254  | 必输 | 柜面输入 |                    |                                |                                     | 大额、小额、超级网银、银联个人入账、银联对公入账、（28个同城支付系统），做成勾选选，可多选和全选 |
| D_PAY_LIMIT        | 单日代发限额       | float  | 16.2 | 必输 | 柜面输入 |                    |                                |                                     | 表示该账户用于代发交易可支付的限额，仅控制智能代发交易，客户单独通过中平发起的代发交易不受控 |
| M_PAY_LIMIT        | 月代发限额         | float  | 16.2 | 必输 | 柜面输入 |                    |                                |                                     | 表示该账户用于代发交易可支付的限额，仅控制智能代发交易，客户单独通过中平发起的代发交易不受控制。月代发限额为自然月控制。 |
| S_PAY_LIMIT        | 单笔代发限额控制   | float  | 16.2 | 必输 | 柜面输入 |                    |                                |                                     | 最高为1000万元。                                             |
| START_DATE         | 生效日期           | string | 8    | 必输 | 柜面输入 |                    |                                |                                     | 不输入代表当日生效，输入必须大于等于当日                     |
| END_DATE           | 终止日期           | string | 8    | 必输 | 柜面输入 |                    |                                |                                     | 不输入则赋“20991231”，输入则必须大于当天                     |
| CUST_MGR_NO        | 客户经理           | string | 11   | 选输 | 柜面输入 |                    |                                |                                     |                                                              |
| TEL                | 联系电话           | string | 20   | 选输 | 柜面输入 |                    |                                |                                     |                                                              |
| PHONE              | 联系手机           | string | 50   | 选输 | 柜面输入 |                    |                                |                                     |                                                              |
| EMAIL              | 电子邮箱           | string | 50   | 选输 | 柜面输入 |                    |                                |                                     |                                                              |
| AFFIX_NAME         | 商户法定名称       | string | 100  | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| FEE_NAME           | 商户经营名称       | string | 60   | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| MUNIT_CODE         | 收单机构代码       | string | 12   | 必输 | 回显     |                    |                                |                                     |                                                              |
| AREA_CODE          | 地区代码           | string | 8    | 必输 | 回显     |                    |                                |                                     |                                                              |
| ENTP_TYPE          | 商户类别码         | string | 4    | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
|                    | 商户状态           | string |      | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| FILE_TYPE          | 营业证明文件类型   | string | 4    | 必输 | 回显     |                    |                                |                                     |                                                              |
| FILE_NO            | 营业证明文件号码   | string | 30   | 必输 | 回显     |                    |                                |                                     |                                                              |
| ADDR               | 商户经营地址       | string | 150  | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| REG_ADDR           | 商户注册地址       | string | 150  | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| CTRY_ENAME         | 商户英文名称       | string | 150  | 必输 | 回显     |                    |                                |                                     |                                                              |
| CUST_NAME          | 法人代表姓名       | string | 60   | 必输 | 回显     |                    |                                |                                     |                                                              |
| ID_TYPE            | 法定代表人证件类型 | string | 2    | 必输 | 回显     |                    |                                |                                     |                                                              |
| PERSONCODE         | 法人代表证件号码   | string | 24   | 必输 | 回显     |                    |                                |                                     |                                                              |
| HANDLE_NAME        | 经办人姓名         | string | 60   | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| HANDLE_PAPER_TYPE  | 经办人有效证件类型 | string | 2    | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| HANDLE_PAPER_NO    | 经办人证件号码     | string | 24   | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| PROP_ADDR          | 经办人通讯地址     | string | 150  | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| TELEPHONE          | 商户联系人电话     | string | 12   | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| PHONE              | 移动电话           | string | 12   | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| BW_FLAG            | 是否收取手续费     | string | 1    | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| ADJ_AMT            | 按笔收费标准       | float  | 16.2 | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| FROM_UNIT          | 商户结算机构       | string | 8    | 必输 | 回显     |                    |                                |                                     |                                                              |
| BGN_DATE           | 商户启用日期       | string | 8    | 必输 | 柜面输入 |                    |                                |                                     |                                                              |
| END_DATE           | 商户停止日期       | string | 8    | 必输 | 柜面输入 |                    |                                |                                     |                                                              |

 

### **1.1.4** **界面设计**

​	无

### **1.1.5** 处理逻辑

![img](file:///C:\Users\THTF\AppData\Local\Temp\ksohtml\wpsF6C4.tmp.png) 

Ø 处理流程说明

1) 从总线中取出交易类型FUNCTION及账号ACCOUNT。

2) 根据传入的交易类型码分别对应程序中的签约、解约、查询、维护。

a) 签约：

\1. 从总线中取出各项签约参数信息。

\2. 当发起渠道为银联时，从总线取出银联代付签约参数信息。

\3. 检测是否已经进行了银联代付签约，若未签约，进行银联代付签约。

\4. 进行智能代发签约，登记信息到智能代发签约登记表，交易成功。

b) 解约：

\1. 根据总线获取的账号信息，在智能代发签约登记表中检索对应记录。

\2. 修改生效状态（VALID_FLAG）为失效，更新到智能代发签约登记表，交易成功。

c) 查询：

\1. 根据总线获取的签约信息，在智能代发签约登记表中检索对应记录。

\2. 返回结果，交易结束。

d) 维护：

\1. 根据总线获取的账号信息，在智能代发签约登记表中检索对应记录。

\2. 从总线中获取前台修改后的签约参数，修改到原签约记录中。

\3. 将修改后的签约记录，更新到智能代发签约登记表，返回处理结果。

3) 交易结束。

 

### **1.1.6** **接口调用**	

| 系统名称 | 交易名称 | 交易代码 |
| -------- | -------- | -------- |
| POS      | 商户签约 | 160700   |

 

### **1.1.7** **限制条件**

无

### **1.1.8** **异常处理**

| 异常情况   | 处理方法                                                     |
| ---------- | ------------------------------------------------------------ |
| 捕获的异常 | 代码中捕获的异常，以友好的方式在日志中提示错误的内容及建议处理方式。 |
| 未捕获异常 | 通过系统配置，未捕获的异常统一返回前端错误信息。系统通过配置在日志中记录ERROR级日志，便于系统管理员查看相关日志。 |

### **1.1.9** **其他方面**

无

### **1.1.10** **测试要点**

| 测试要点 | 要点说明                             |
| -------- | ------------------------------------ |
| 常规测试 | 确保每项功能正常执行，满足权限要求。 |